import{f as H,s as x,C as P}from"./index-e77a39a7.js";import{u as Q}from"./index-8d3b4b42.js";import{D as X}from"./@element-plus.icons-vue-e3809a99.js";import{_ as Y}from"./func-logs.vue_vue_type_script_setup_true_lang-46f1dfac.js";import{a as _}from"./element-plus-aceaa6a8.js";import{d as N,e as Z,W as i,_ as ee,o as r,c as m,a as e,b as s,J as c,N as g,K as oe,I as S,F as te,am as se,al as ne}from"./@vue.runtime-core-3a9e54b6.js";import{r as h,j as le,u as d}from"./@vue.reactivity-747ae439.js";import{O as y,o as ae}from"./@vue.shared-9aa0355e.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";import"./@vue.runtime-dom-7b7b8a44.js";import"./monaco-editor-9ddaeaf3.js";import"./store-4dd21bbb.js";import"./chardet-ee49d9b4.js";import"./axios-aba6f0e0.js";import"./nprogress-d2c1a460.js";import"./lodash-es-d00cf236.js";import"./@vueuse.core-b5ce6112.js";import"./@vueuse.shared-8ce56883.js";import"./mitt-b509fb6d.js";import"./vue-router-19ed6b98.js";import"./pinia-2b0aea45.js";import"./vue-demi-71ba0ef2.js";import"./vue-echarts-c84fbe77.js";import"./resize-detector-a5205554.js";import"./echarts-90e4e057.js";import"./tslib-54e39b60.js";import"./zrender-5c8f9fce.js";import"./mockjs-5923ee6a.js";import"./vue-1fcee0a5.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-384ef2e5.js";import"./dayjs-98968027.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-a30dd394.js";import"./@floating-ui.core-a4bcb9d9.js";import"./index-f25a0731.js";const u=p=>(se("data-v-6005dc2d"),p=p(),ne(),p),ce={class:"head"},re={class:"name"},de={class:"card code"},_e={class:"h"},ue={class:"c"},me={class:"debug"},pe={class:"card br"},fe={class:"h"},ve=u(()=>e("span",null,"调用参数",-1)),ge={class:"c"},he={class:"card"},ye={class:"h"},Ce=u(()=>e("span",null,"执行日志",-1)),ke={class:"c is-border"},we={class:"c2"},be={class:"row"},qe=u(()=>e("div",{class:"row"},[e("span",null,"执行时间：2023-02-16 01:23:00")],-1)),xe={class:"row"},Se=u(()=>e("span",null,"执行状态：",-1)),Ve={key:0,class:"ok"},ze={key:1,class:"fail"},Ke=u(()=>e("span",{style:{"margin-left":"20px"}},"耗时：",-1)),$e=u(()=>e("div",{class:"row"},"执行结果：",-1)),Be={key:1,class:"error"},De=N({name:"cloud-func-dev"}),Ie=N({...De,setup(p){const{route:L,service:C,refs:k,setRefs:w,router:R}=Q(),{browser:j}=H(),b=h(!1),q=h(!1),f=h(!1),n=le({req:"",log:{error:"",type:0,time:0,createTime:"",result:{},request:{method:""}}}),a=h({content:""});async function V(o){b.value=!0,await C.cloud.func.info.info({id:L.query.id}).then(t=>{o||(t.content=x.get(`cloud.devCode-${t.id}`)||t.content,n.req=x.get(`cloud.devReq-${t.id}`)||P.req),a.value=t}).catch(t=>{_.error(t.message)}),b.value=!1}async function z(){q.value=!0,await k.code.formatCode(),await C.cloud.func.info.update({id:a.value.id,content:a.value.content}).then(()=>{_.success("保存成功")}).catch(o=>{_.error(o.message)}),q.value=!1}async function K(){f.value=!0,await k.req.formatCode();try{await C.cloud.func.info.invoke({id:a.value.id,content:a.value.content,...JSON.parse(n.req)}).then(o=>{n.log=o,_.success("运行成功")}).catch(o=>{n.log.time=0,_.error(o.message)})}catch(o){_.error(o==null?void 0:o.toString())}f.value=!1}function $(o,t){x.set(`cloud.${o}-${a.value.id}`,t)}function M(o){o.ctrlKey&&o.key.toLocaleLowerCase()=="s"&&(z(),o.preventDefault())}function E(o){o.ctrlKey&&o.key.toLocaleLowerCase()=="b"&&(K(),o.preventDefault())}return Z(()=>{V()}),(o,t)=>{const F=i("el-icon"),v=i("el-button"),J=i("el-tooltip"),O=i("cl-flex1"),B=i("cl-editor-monaco"),D=i("el-col"),T=i("cl-code-json"),U=i("el-empty"),W=i("el-scrollbar"),A=i("el-row"),G=ee("loading");return r(),m("div",{class:ae(["func-dev",{"is-mini":d(j).isMini}])},[e("div",ce,[s(F,{class:"back",onClick:d(R).back},{default:c(()=>[s(d(X))]),_:1},8,["onClick"]),e("span",re,"云函数（"+y(a.value.name)+"）",1)]),e("div",de,[e("div",_e,[s(J,{content:"重新加载函数代码,将会丢失当前未保存的编辑",effect:"light"},{default:c(()=>[s(v,{size:"small",loading:b.value,onClick:t[0]||(t[0]=l=>V(!0))},{default:c(()=>[g(" 刷新 ")]),_:1},8,["loading"])]),_:1}),s(v,{size:"small",type:"success",loading:q.value,onClick:z},{default:c(()=>[g(" 保存(S) ")]),_:1},8,["loading"]),s(O)]),e("div",ue,[s(B,{ref:d(w)("code"),height:"100%",language:"typescript",options:{fontSize:18},modelValue:a.value.content,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.content=l),onChange:t[2]||(t[2]=l=>{$("devCode",l)}),onKeydown:M},null,8,["modelValue"])])]),e("div",me,[s(A,null,{default:c(()=>[s(D,{sm:12,xs:24},{default:c(()=>[e("div",pe,[e("div",fe,[ve,s(v,{size:"small",type:"success",loading:f.value,onClick:K},{default:c(()=>[g(" 运行(B) ")]),_:1},8,["loading"])]),e("div",ge,[s(B,{ref:d(w)("req"),height:"100%",options:{fontSize:18},modelValue:n.req,"onUpdate:modelValue":t[3]||(t[3]=l=>n.req=l),onKeydown:E,onChange:t[4]||(t[4]=l=>{$("devReq",l)})},null,8,["modelValue"])])])]),_:1}),s(D,{sm:12,xs:24},{default:c(()=>[e("div",he,[e("div",ye,[Ce,s(v,{text:"",size:"small",onClick:t[5]||(t[5]=l=>{var I;return(I=d(k).logs)==null?void 0:I.open(a.value)})},{default:c(()=>[g(" 查看全部 ")]),_:1})]),e("div",ke,[oe((r(),S(W,null,{default:c(()=>{var l;return[e("div",we,[n.log.time>0?(r(),m(te,{key:0},[e("div",be,[e("span",null,"执行方法："+y((l=n.log.request)==null?void 0:l.method),1)]),qe,e("div",xe,[Se,n.log.type==1?(r(),m("span",Ve,"成功")):(r(),m("span",ze,"失败")),Ke,e("span",null,y(n.log.time)+"ms",1)]),$e,n.log.type==1?(r(),S(T,{key:0,height:"auto","model-value":n.log.result},null,8,["model-value"])):(r(),m("div",Be,y(n.log.error),1))],64)):(r(),S(U,{key:1,"image-size":80}))])]}),_:1})),[[G,f.value]])])])]),_:1})]),_:1})]),s(Y,{ref:d(w)("logs")},null,512)],2)}}});const Co=ie(Ie,[["__scopeId","data-v-6005dc2d"]]);export{Co as default};
