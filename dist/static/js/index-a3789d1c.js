import{l as Z,v as ee}from"./@vue.runtime-dom-7b7b8a44.js";import{n as G,m as te,R as se,B as oe,a1 as ie}from"./@element-plus.icons-vue-e3809a99.js";import{i as D,f as le}from"./index-e77a39a7.js";import"./store-4dd21bbb.js";import{v as ne}from"./lodash-es-d00cf236.js";import{a as h,b as ae}from"./element-plus-aceaa6a8.js";import{d as K,H as re,y as ce,e as ue,W as b,_ as O,o as n,c as _,a as r,E as k,b as l,J as u,M as H,I as w,n as de,K as E,F as pe,U as _e}from"./@vue.runtime-core-3a9e54b6.js";import{j as me,r as C,u as c}from"./@vue.reactivity-747ae439.js";import{o as J,O as B}from"./@vue.shared-9aa0355e.js";import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";import"./monaco-editor-9ddaeaf3.js";import"./axios-aba6f0e0.js";import"./nprogress-d2c1a460.js";import"./chardet-ee49d9b4.js";import"./@vueuse.core-b5ce6112.js";import"./@vueuse.shared-8ce56883.js";import"./mitt-b509fb6d.js";import"./vue-router-19ed6b98.js";import"./pinia-2b0aea45.js";import"./vue-demi-71ba0ef2.js";import"./vue-echarts-c84fbe77.js";import"./resize-detector-a5205554.js";import"./echarts-90e4e057.js";import"./tslib-54e39b60.js";import"./zrender-5c8f9fce.js";import"./mockjs-5923ee6a.js";import"./vue-1fcee0a5.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-384ef2e5.js";import"./dayjs-98968027.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-a30dd394.js";import"./@floating-ui.core-a4bcb9d9.js";const fe={class:"cl-view-group__wrap"},ge={class:"cl-view-group__left"},he={class:"scope"},be={class:"head"},ke={class:"list"},we=["infinite-scroll-disabled"],Ce=["onClick","onContextmenu"],ye={class:"cl-view-group__right"},xe={class:"head"},Me={class:"title"},$e={key:0,class:"content"},Ee=K({name:"cl-view-group"}),Be=K({...Ee,setup(Se,{expose:L}){Z(e=>({"64b55542":c(s).leftWidth}));const{browser:y,onScreenChange:P}=le(),R=re(),N=D.useForm(),s=me(Object.assign({label:"组",title:"列表",leftWidth:"300px",service:{}},ce("useViewGroup__options"))),W=!!R.left;ne(s.service)&&!W&&console.error("[cl-view-group] 参数 service 不能为空");const S=C(!1),p=C([]),m=C(!0),a=C();function v(e){m.value=e===void 0?!m.value:e}function x(e){e||(e=p.value[0]),a.value=e,de(()=>{e&&(y.isMini&&v(!1),s.onSelect&&s.onSelect(e))})}function F(e){var t,o;(o=N.value)==null||o.open({title:(e?"编辑":"添加")+s.label,form:{...e},on:{submit(d,{close:$,done:j}){s.service[e?"update":"add"](d).then(()=>{h.success("保存成功"),e?Object.assign(e,d):f(),$()}).catch(V=>{h.error(V.message),j()})}},...(t=s.onEdit)==null?void 0:t.call(s,e)},[D.setFocus()])}function I(e){ae.confirm("此操作将会删除选择的数据，是否继续？","提示",{type:"warning"}).then(()=>{s.service.delete({ids:[e.id]}).then(async()=>{var t;h.success("删除成功"),await f(),((t=a.value)==null?void 0:t.id)==e.id&&x()}).catch(t=>{h.error(t.message)})}).catch(()=>null)}const M={order:"createTime",sort:"asc",page:1,size:20},T=C(!1);async function f(e){Object.assign(M,e),S.value=!0,await s.service.page(M).then(t=>{var d;const o=((d=s.onData)==null?void 0:d.call(s,t.list))||t.list;M.page==1?p.value=o:p.value.push(...o),a.value||x(p.value[0]),T.value=t.pagination.total<=p.value.length}).catch(t=>{h.error(t.message)}),S.value=!1}function U(){f({page:M.page+1})}function A(e,t){D.ContextMenu.open(e,{hover:{target:"item"},list:[{label:"编辑",hidden:!s.service._permission.update,callback(o){o(),F(t)}},{label:"删除",hidden:!s.service._permission.delete,callback(o){o(),I(t)}}],...s.onContextMenu&&s.onContextMenu(t)})}return P(()=>{v(!y.isMini)}),L({selected:a,isExpand:m,expand:v,select:x,browser:y,edit:F,remove:I}),ue(()=>{W||f()}),(e,t)=>{const o=b("el-icon"),d=b("el-tooltip"),$=b("el-empty"),j=b("el-scrollbar"),V=b("cl-form"),Q=O("permission"),X=O("infinite-scroll"),Y=O("loading");return n(),_("div",{class:J(["cl-view-group",[m.value?"is-expand":"is-collapse"]])},[r("div",fe,[r("div",ge,[k(e.$slots,"left",{},()=>[r("div",he,[r("div",be,[r("span",null,B(c(s).label),1),l(d,{content:"刷新"},{default:u(()=>[l(o,{onClick:t[0]||(t[0]=i=>f())},{default:u(()=>[l(c(se))]),_:1})]),_:1}),l(d,{content:"添加"},{default:u(()=>[E((n(),w(o,{onClick:t[1]||(t[1]=i=>F())},{default:u(()=>[l(c(oe))]),_:1})),[[Q,c(s).service.permission.add]])]),_:1})]),E((n(),_("div",ke,[l(j,null,{default:u(()=>[E((n(),_("ul",{"infinite-scroll-immediate":!1,"infinite-scroll-disabled":T.value},[(n(!0),_(pe,null,_e(p.value,(i,z)=>(n(),_("li",{key:z,onClick:g=>x(i),onContextmenu:g=>{A(g,i)}},[k(e.$slots,"item",{item:i,selected:a.value,index:z},()=>{var g,q;return[r("div",{class:J(["item",{"is-active":((g=a.value)==null?void 0:g.id)==i.id}])},[k(e.$slots,"item-name",{item:i,selected:a.value,index:z},()=>[r("span",null,B(i.name),1)],!0),E(l(o,{class:"arrow-right"},{default:u(()=>[l(c(ie))]),_:2},1536),[[ee,((q=a.value)==null?void 0:q.id)==i.id]])],2)]},!0)],40,Ce))),128)),p.value.length==0?(n(),w($,{key:0,"image-size":80})):H("",!0)],8,we)),[[X,U]])]),_:3})])),[[Y,S.value]])])],!0),c(y).isMini?(n(),_("div",{key:0,class:"collapse-btn",onClick:t[2]||(t[2]=i=>v(!1))},[l(o,null,{default:u(()=>[l(c(G))]),_:1})])):H("",!0)]),r("div",ye,[r("div",xe,[r("div",{class:"icon",onClick:t[3]||(t[3]=i=>v())},[m.value?(n(),w(o,{key:0},{default:u(()=>[l(c(te))]),_:1})):(n(),w(o,{key:1},{default:u(()=>[l(c(G))]),_:1}))]),k(e.$slots,"title",{selected:a.value},()=>{var i;return[r("span",Me,B(c(s).title)+"（"+B(((i=a.value)==null?void 0:i.name)||"未选择")+"） ",1)]},!0)]),a.value?(n(),_("div",$e,[k(e.$slots,"right",{},void 0,!0)])):(n(),w($,{key:1,"image-size":80}))])]),l(V,{ref_key:"Form",ref:N},null,512)],2)}}});const pt=ve(Be,[["__scopeId","data-v-9968dea4"]]);export{pt as default};
