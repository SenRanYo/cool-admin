import{w as S}from"./@vue.runtime-dom-7b7b8a44.js";import{i as M,f as J}from"./index-e77a39a7.js";import"./store-4dd21bbb.js";import{u as j}from"./index-8d3b4b42.js";import{B as K,W as L,X as P,Y as R,P as X}from"./@element-plus.icons-vue-e3809a99.js";import{d as V,W as l,o as c,I as T,J as i,b as n,n as G,ag as Q,_ as Z,c as h,a as p,F as E,U as ee,K as $,am as te,al as oe,N as U}from"./@vue.runtime-core-3a9e54b6.js";import{r as z,j as se,u as r}from"./@vue.reactivity-747ae439.js";import{a as b,b as N}from"./element-plus-aceaa6a8.js";import{o as ne,O as H}from"./@vue.shared-9aa0355e.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import"./monaco-editor-9ddaeaf3.js";import"./axios-aba6f0e0.js";import"./nprogress-d2c1a460.js";import"./chardet-ee49d9b4.js";import"./lodash-es-d00cf236.js";import"./@vueuse.core-b5ce6112.js";import"./@vueuse.shared-8ce56883.js";import"./mitt-b509fb6d.js";import"./vue-router-19ed6b98.js";import"./pinia-2b0aea45.js";import"./vue-demi-71ba0ef2.js";import"./vue-echarts-c84fbe77.js";import"./resize-detector-a5205554.js";import"./echarts-90e4e057.js";import"./tslib-54e39b60.js";import"./zrender-5c8f9fce.js";import"./mockjs-5923ee6a.js";import"./vue-1fcee0a5.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-384ef2e5.js";import"./dayjs-98968027.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-a30dd394.js";import"./@floating-ui.core-a4bcb9d9.js";const le=V({name:"undefined"}),ie=V({...le,setup(g,{expose:s}){const{service:W}=j(),f=z(!1),B=z(""),y=se({status:[{label:"成功",value:1,type:"success"},{label:"失败",value:0,type:"danger"}]}),D=M.useTable({autoHeight:!1,columns:[{label:"#",type:"index"},{label:"描述",prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:"执行状态",prop:"status",minWidth:120,dict:y.status},{label:"执行时间",prop:"createTime",minWidth:160}]}),u=M.useCrud({service:W.task.info,dict:{api:{page:"log"}}});function F(k){f.value=!0,B.value=`日志列表（${k.name}）`,G(()=>{var _;(_=u.value)==null||_.refresh({id:k.id,page:1})})}function I(){f.value=!1}return s({open:F,close:I}),(k,_)=>{const x=l("cl-refresh-btn"),Y=l("cl-select"),q=l("cl-filter"),t=l("cl-row"),o=l("cl-table"),e=l("cl-flex1"),d=l("cl-pagination"),C=l("cl-crud"),w=l("cl-dialog");return c(),T(w,{modelValue:f.value,"onUpdate:modelValue":_[0]||(_[0]=m=>f.value=m),title:B.value,width:"1000px"},{default:i(()=>[n(C,{ref_key:"Crud",ref:u,padding:"0"},{default:i(()=>[n(t,null,{default:i(()=>[n(x),n(q,{label:"状态"},{default:i(()=>[n(Y,{options:y.status,prop:"status"},null,8,["options"])]),_:1})]),_:1}),n(t,null,{default:i(()=>[n(o,{ref_key:"Table",ref:D},null,512)]),_:1}),n(t,null,{default:i(()=>[n(e),n(d)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),O=g=>(te("data-v-48a84cf3"),g=g(),oe(),g),re={class:"list"},ce=["onClick","onContextmenu"],pe={class:"name"},ue={class:"row"},de=O(()=>p("span",null,"执行服务",-1)),_e={class:"row"},me=O(()=>p("span",null,"定时规则",-1)),fe={class:"status"},ke=O(()=>p("p",null,"添加计划任务",-1)),ve=V({name:"task-list"}),he=V({...ve,setup(g){const{service:s,refs:W,setRefs:f}=j(),{browser:B}=J(),y=M.useForm(),D=z([]);function u(){s.task.info.page({size:100,page:1}).then(t=>{D.value=t.list.map(o=>(o.every&&(o._every=parseInt(String(o.every/1e3))),o))})}function F(t){N.confirm(`此操作将启用任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.start({id:t.id,type:t.type}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function I(t){N.confirm(`此操作将停用任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.stop({id:t.id}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function k(t){N.confirm(`此操作将删除任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.delete({ids:[t.id]}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function _(t){W.log.open(t)}async function x(t){var o;if(t&&!s.task.info._permission.update)return!1;(o=y.value)==null||o.open({title:"编辑计划任务",width:"600px",props:{labelWidth:"80px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:"类型",prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:"时间间隔",value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:e})=>e.taskType==1,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:"间隔(秒)",prop:"every",hidden:({scope:e})=>e.taskType==0,hook:{bind(e){return e/1e3},submit(e){return e*1e3}},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:"开始时间",prop:"startDate",hidden:({scope:e})=>e.taskType==1,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...t},on:{submit:(e,{close:d,done:C})=>{e.limit||(e.limit=null),s.task.info[t!=null&&t.id?"update":"add"](e).then(()=>{u(),b.success("保存成功"),d()}).catch(w=>{b.error(w.message),C()})}}},[M.setFocus()])}function Y(t){s.task.info.once({id:t.id}).then(()=>{u()}).catch(o=>{b.error(o.message)})}function q(t,o){M.ContextMenu.open(t,{list:[o.status?{label:"暂停",hidden:!s.task.info._permission.stop,callback(e){I(o),e()}}:{label:"开始",hidden:!s.task.info._permission.start,callback(e){F(o),e()}},{label:"立即执行",hidden:!s.task.info._permission.once,callback(e){Y(o),e()}},{label:"编辑",hidden:!(s.task.info._permission.update&&s.task.info._permission.info),callback(e){x(o),e()}},{label:"删除",hidden:!s.task.info._permission.delete,callback(e){k(o),e()}},{label:"查看日志",hidden:!s.task.info._permission.log,callback(e){_(o),e()}}]})}return Q(()=>{u()}),(t,o)=>{const e=l("el-tag"),d=l("el-icon"),C=l("cl-flex1"),w=l("cl-form"),m=Z("permission");return c(),h("div",{class:ne(["task-list",{"is-mini":r(B).isMini}])},[p("div",re,[(c(!0),h(E,null,ee(D.value,(a,A)=>(c(),h("div",{key:A,class:"item",onClick:v=>x(a),onContextmenu:v=>{q(v,a)}},[p("p",pe,H(a.name),1),p("p",ue,[de,p("span",null,H(a.service),1)]),p("p",_e,[me,p("span",null,H(a.taskType==1?`间隔${a._every}秒执行`:a.cron),1)]),p("div",fe,[a.status?(c(),h(E,{key:0},[n(e,{"disable-transitions":"",effect:"dark",type:"success"},{default:i(()=>[U("进行中")]),_:1}),$((c(),T(d,{class:"pause",onClick:S(v=>I(a),["stop"])},{default:i(()=>[n(r(L))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.stop]])],64)):(c(),h(E,{key:1},[n(e,{"disable-transitions":"",effect:"dark",type:"danger"},{default:i(()=>[U("已停止")]),_:1}),$((c(),T(d,{class:"play",onClick:S(v=>F(a),["stop"])},{default:i(()=>[n(r(P))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.start]])],64)),n(C),$((c(),T(d,{class:"log",onClick:S(v=>_(a),["stop"])},{default:i(()=>[n(r(R))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.log]]),$((c(),T(d,{class:"delete",onClick:S(v=>k(a),["stop"])},{default:i(()=>[n(r(X))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.delete]])])],40,ce))),128)),$((c(),h("div",{class:"item is-add",onClick:o[0]||(o[0]=a=>x())},[n(d,null,{default:i(()=>[n(r(K))]),_:1}),ke])),[[m,r(s).task.info.permission.add]])]),n(w,{ref_key:"Form",ref:y},null,512),n(ie,{ref:r(f)("log")},null,512)],2)}}});const ot=ae(he,[["__scopeId","data-v-48a84cf3"]]);export{ot as default};
