import{i as w}from"./index-e77a39a7.js";import{F as y}from"./file-saver-86ddfd44.js";import{x}from"./xlsx-a2ec4ec1.js";import{d as b}from"./dayjs-98968027.js";import{a as _}from"./element-plus-aceaa6a8.js";import{d as S,b as E,W as A}from"./@vue.runtime-core-3a9e54b6.js";import{r as k,i as W}from"./@vue.reactivity-747ae439.js";import"./@vue.runtime-dom-7b7b8a44.js";import"./@vue.shared-9aa0355e.js";import"./monaco-editor-9ddaeaf3.js";import"./store-4dd21bbb.js";import"./chardet-ee49d9b4.js";import"./axios-aba6f0e0.js";import"./nprogress-d2c1a460.js";import"./lodash-es-d00cf236.js";import"./@vueuse.core-b5ce6112.js";import"./@vueuse.shared-8ce56883.js";import"./mitt-b509fb6d.js";import"./vue-router-19ed6b98.js";import"./pinia-2b0aea45.js";import"./vue-demi-71ba0ef2.js";import"./vue-echarts-c84fbe77.js";import"./resize-detector-a5205554.js";import"./echarts-90e4e057.js";import"./tslib-54e39b60.js";import"./zrender-5c8f9fce.js";import"./mockjs-5923ee6a.js";import"./vue-1fcee0a5.js";import"./@element-plus.icons-vue-e3809a99.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-384ef2e5.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-a30dd394.js";import"./@floating-ui.core-a4bcb9d9.js";import"./mqtt-b64b1577.js";function B(t,c){for(var n={},e={s:{c:1e7,r:1e7},e:{c:0,r:0}},a=0;a!=t.length;++a)for(var m=0;m!=t[a].length;++m){e.s.r>a&&(e.s.r=a),e.s.c>m&&(e.s.c=m),e.e.r<a&&(e.e.r=a),e.e.c<m&&(e.e.c=m);var p={v:t[a][m]};if(p.v!=null){var d=x.utils.encode_cell({c:m,r:a});p.t="s",n[d]=p}}return e.s.c<1e7&&(n["!ref"]=x.utils.encode_range(e)),n}function g(){if(!(this instanceof g))return new g;this.SheetNames=[],this.Sheets={}}function F(t){for(var c=new ArrayBuffer(t.length),n=new Uint8Array(c),e=0;e!=t.length;++e)n[e]=t.charCodeAt(e)&255;return c}function N({multiHeader:t=[],header:c,data:n,filename:e,merges:a=[],autoWidth:m=!0,bookType:p="xlsx"}={}){e=e||"excel-list",n=[...n],n.unshift(c);for(let o=t.length-1;o>-1;o--)n.unshift(t[o]);var d="SheetJS",f=new g,l=B(n);if(a.length>0&&(l["!merges"]||(l["!merges"]=[]),a.forEach(o=>{l["!merges"].push(x.utils.decode_range(o))})),m){const o=n.map(r=>r.map(i=>i==null?{wch:10}:i.toString().charCodeAt(0)>255?{wch:i.toString().length*2}:{wch:i.toString().length}));let s=o[0];for(let r=1;r<o.length;r++)for(let i=0;i<o[r].length;i++)s[i].wch<o[r][i].wch&&(s[i].wch=o[r][i].wch);l["!cols"]=s}f.SheetNames.push(d),f.Sheets[d]=l;var u=x.write(f,{bookType:p,bookSST:!1,type:"binary"});y.saveAs(new Blob([F(u)],{type:"application/octet-stream"}),`${e}.${p}`)}const ht=S({name:"cl-export-btn",props:{filename:[Function,String],autoWidth:{type:Boolean,default:!0},bookType:{type:String,default:"xlsx"},header:Array,columns:{type:Array},data:[Function,Array],maxExportLimit:Number},setup(t,{slots:c}){const n=k(!1),e=w.useCrud();async function a(f,l){return f.filter(u=>!u.hidden&&l.includes(u.prop)).map(u=>u.label)}function m(){var l,u;const f={...(l=e.value)==null?void 0:l.paramsReplace(e.value.params),maxExportLimit:t.maxExportLimit,isExport:!0};return typeof t.data=="function"?t.data(f):t.data?t.data:(u=e.value)==null?void 0:u.service.page(f).then(o=>o.list.map(s=>{for(const r in s){const i=t.columns.find(h=>h.prop==r);if(i&&(i.formatter&&(s[r]=i.formatter(s)),i.dict)){const h=(W(i.dict)?i.dict.value:i.dict).find(v=>v.value==s[r]);h&&(s[r]=h.label)}}return s})).catch(o=>(_.error(o.message),null))}async function p(){return typeof t.filename=="function"?await(t==null?void 0:t.filename()):t.filename||`报表（${b().format("YYYY-MM-DD HH_mm_ss")}）`}async function d(){if(!t.columns)return console.error("columns is required");n.value=!0;const f=t.columns.filter(r=>!(r.hidden===!0||["selection","expand","index"].includes(r.type)||r.filterExport||r["filter-export"])),l=f.map(r=>r.prop).filter(Boolean),u=await a(f,l);let o=await m();if(!o)return n.value=!1,console.error("导出数据异常");const s=await p();o=o.map(r=>l.map(i=>r[i])),N({header:u,data:o,filename:s,autoWidth:t.autoWidth,bookType:t.bookType}),n.value=!1}return()=>E(A("el-button"),{loading:n.value,onClick:d},{default:()=>[c.default?c.default():"导出"]})}});export{ht as default};
