import{p as I,o as h,u as k}from"./index-e77a39a7.js";import{A as F}from"./lodash-es-d00cf236.js";import{W as v}from"./ts-wps-d32de3c6.js";import"./store-4dd21bbb.js";import{u as w}from"./index-8d3b4b42.js";import{a as S}from"./element-plus-aceaa6a8.js";import{d as u,W as x,o as d,I as y,J as T,a as V,c as W,M as P,b as j}from"./@vue.runtime-core-3a9e54b6.js";import{r as g,j as B,u as R,t as A}from"./@vue.reactivity-747ae439.js";import{_ as D}from"./_plugin-vue_export-helper-c27b6911.js";const m=[{label:"图片",value:"image",format:["bmp","jpg","jpeg","png","tif","gif","svg","webp"],color:"#67C23A"},{label:"视频",value:"video",format:["avi","wmv","mpg","mpeg","mov","rm","ram","swf","flv","mp4"],color:"#409EFF"},{label:"音频",value:"audio",format:["mp3","wav","wma","mp2","flac","midi","ra","ape","aac","cda"],color:"#E6A23C"},{label:"文字",value:"Writer",format:["doc","dot","wps","wpt","docx","dotx","docm","dotm"],color:"#F56C6C"},{label:"表格",value:"Spreadsheet",format:["xls","xlt","et","xlsx","xltx","xlsm","xltm"],color:"#F56C6C"},{label:"演示",value:"Presentation",format:["ppt","pptx","pptm","ppsx","ppsm","pps","potx","potm","dpt","dps"],color:"#F56C6C"},{label:"PDF",value:"Pdf",format:["pdf"],color:"#F56C6C"},{label:"文件",value:"file",format:[],color:"#909399"}];function Y(t){return I(t.substring(t.indexOf("_")+1))}function Z(t){return m.find(n=>n.format.find(p=>p==h(t).toLocaleLowerCase()))||F(m)}function ee(t){return m.find(a=>a.value==t)}function te(t){return t.map(a=>a.url.replace(/,/g,encodeURIComponent(","))).join(",")}const E=V("div",{class:"wps-viewer"},null,-1),N=u({name:"undefined"}),O=u({...N,props:{officeType:{type:String,default:"Writer"},fileId:{type:String,default:""},token:String},setup(t,{expose:a}){const n=t,{service:p}=w(),{user:o}=k(),r=g(""),f=g(!1);async function e(){r.value||await p.space.info.getConfig().then(c=>{r.value=c.appId})}let s=null;async function i(c){if(f.value=!0,await e(),!r.value)return S.error("请先配置WPS的应用ID");s=v.init({officeType:v.OfficeType[c.officeType||n.officeType],appId:r.value,fileId:c.fileId||n.fileId,mount:document.querySelector(".wps-viewer"),fileToken:{token:o.token,timeout:10*60*1e3}}),s.ready()}function l(){s.destroy()}return a({open:i}),(c,_)=>{const b=x("cl-dialog");return d(),y(b,{modelValue:f.value,"onUpdate:modelValue":_[0]||(_[0]=C=>f.value=C),width:"80%",height:"70vh",onClosed:l},{default:T(()=>[E]),_:1},8,["modelValue"])}}});const U={class:"item-viewer"},$=u({name:"item-viewer"}),L=u({...$,setup(t,{expose:a}){const{refs:n,setRefs:p}=w(),o=B({visible:!1,urls:[],index:0});function r(e,s){var i;if(e!=null&&e.type){if(e.type=="image")return o.visible=!0,o.urls=s.filter(l=>l.type=="image").map(l=>l.url||""),o.index=o.urls.findIndex(l=>l==e.url),!0;if(["Writer","Spreadsheet","Presentation","PDF"].includes(e.type))return(i=n.wps)==null?void 0:i.open(Object.assign(A(e),{officeType:e.type}))}window.open(e.url)}function f(){o.visible=!1}return a({open:r}),(e,s)=>{const i=x("el-image-viewer");return d(),W("div",U,[o.visible?(d(),y(i,{key:0,"url-list":o.urls,"initial-index":o.index,infinite:"",teleported:"",onClose:f},null,8,["url-list","initial-index"])):P("",!0),j(O,{ref:R(p)("wps")},null,512)])}}});const oe=D(L,[["__scopeId","data-v-ec174214"]]);export{oe as I,Y as a,Z as b,ee as f,te as g};
